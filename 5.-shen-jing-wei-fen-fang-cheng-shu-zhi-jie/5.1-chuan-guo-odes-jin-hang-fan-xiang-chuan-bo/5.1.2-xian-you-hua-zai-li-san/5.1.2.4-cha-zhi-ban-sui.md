# 5.1.2.4 插值伴随

有可能对连续伴随法中的数值误差问题进行微调。&#x20;

记录前向计算时特定位置的$$y(t)$$值（但不记录用于获得这些$$y(t)$$的求解器的内部操作）。然后在后向求解过程中不需要重新计算$$y(t)$$，而是使用后向求解过程中需要的任何$$t$$值的内插近似值来解决连续伴随方程。

插值伴随实际上是\[SH05]和\[Rac+20b]中使用的默认反向传播方法，例如。\[Kim+21a]报告说，在一个刚性微分方程上，发现先优化后离散的伴随方法失败了，但插值伴随和先离散后优化都成功了。



**稳定性和刚性**  使用插值伴随意味着所解的微分方程——对于前向时间的$$y(t)$$，和后向时间的$$a_y(t)$$——现在表现出非常相似的行为，特别是在稳定性和刚度方面。

微分方程的局部行为是通过矢量场的特征值来理解的\[But16，第112节]，\[HNW08，第I.13节，公式（13.2）]。

对于$$y(t)$$，这是$$\frac{\partial f_{\theta}}{\partial y}(t, y(t))$$。同时，对于$$a_y(t)$$和$$a_θ(t)$$，这是

$$
\begin{aligned}
\frac{\partial}{\partial a_{y}}\left(-a_{y}(t) \cdot \frac{\partial f_{\theta}}{\partial y}(t, y(t))\right) &=-\frac{\partial f_{\theta}}{\partial y}(t, y(t)), \\
\frac{\partial}{\partial a_{\theta}}\left(-a_{y}(t) \cdot \frac{\partial f_{\theta}}{\partial \theta}(t, y(t))\right) &=0 .
\end{aligned}
$$

$$a_θ(t)$$的（局部）行为是平凡的，因为该向量场的雅可比系数为零。同时，回顾$$y(t)$$的方程是在时间上向前求解的，$$a_y(t)$$的方程是在时间上向后求解的，我们看到它们的雅可比系数是相同的。

> **备注5.7**  从道义上讲，这是预料之中的：微分得到的是一个函数的局部线性近似——也就是雅可比。在这种情况下，该函数是解决一个ODE的整体行为。同时，目前对系统的局部行为的分析是关于构建矢量场的局部线性近似——雅可比。

> 译者注：这属于ODE的定性分析。

**内存效率**  记录$$y(t)$$的值会产生少量的内存成本，但不像离散优化方法那样记录求解器的每个内部操作。



**插值的选择**  有几种合理的方法来记录和插值$$y(t)$$。\[SH05]使用立方Hermite插值，而\[Dau+20]使用arycentric 拉格朗日插值，在这两种情况下都是记录预先指定的值$$t_1, . . , t_n$$上的$$y(t_1), . . . , y(t_n)$$。

> 脚注：一个具有正实部的特征值描述了一个系统的模式，即 "局部扩张"：各点以指数速度相互发散。同样，负实部描述了一个系统的模式，即 "局部收缩"：各点以指数级的速度靠拢。特征值的虚部对应于一个系统的 "局部旋转"——也见第[2.2.5.1](../../../2.-shen-jing-chang-wei-fen-fang-cheng/2.2-ying-yong/2.2.5-can-cha-wang-luo/2.2.5.1-xuan-zhuan-xiang-liang-chang.md)节。
